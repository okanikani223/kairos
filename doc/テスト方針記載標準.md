# テスト方針記載標準

## 1. 目的
kairosプロジェクトの各機能設計書におけるテスト方針記載を統一し、明確で実行可能なテスト基準を定義する。

## 2. 基本原則

### 2.1. 記載必須性
- 全ての機能設計書でテスト方針セクションを設ける
- 実施可能な具体的テスト項目を定義する
- 機能の特性に応じた適切なテストレベルを適用する

### 2.2. テストレベル適用基準
**Level A（基本機能）**: 標準テスト項目を適用
**Level B（主要機能）**: 詳細化されたテスト項目を適用  
**Level C（複雑機能）**: カスタマイズされたテスト項目を適用

## 3. 記載フォーマット

### 3.1. Level A機能の標準フォーマット

```markdown
## X. テスト方針

### X.1 単体テスト
- **基本機能テスト**: 主要処理の正常系・異常系テスト
- **入力値検証**: パラメータの境界値テスト
- **エラーハンドリング**: 基本的なエラーケースの確認

### X.2 統合テスト
- **API統合テスト**: リクエスト/レスポンスの整合性確認
- **認証・認可**: 基本的な権限制御の確認

### X.3 パフォーマンステスト
- **負荷テスト**: 通常負荷での動作確認
- **応答時間**: 基準時間内での処理完了確認
```

### 3.2. Level B機能の標準フォーマット

```markdown
## X. テスト方針

### X.1 単体テスト
- **[機能固有テスト1]**: [詳細なテストケース]
- **[機能固有テスト2]**: [詳細なテストケース]
- **入力値検証**: 全パラメータの境界値・形式テスト
- **業務ロジック**: [具体的ロジック]の検証テスト
- **エラーハンドリング**: 各エラーケースの適切な処理確認

### X.2 統合テスト
- **API エンドポイント**: [具体的エンドポイント]の統合テスト
- **権限制御**: [詳細な権限パターン]の確認
- **データベース**: トランザクション処理・制約条件の確認
- **[外部連携システム]**: [連携内容]の統合確認

### X.3 パフォーマンステスト
- **負荷テスト**: [具体的負荷条件]での性能確認
- **応答時間**: [具体的基準時間]内での処理完了確認
- **同時処理**: [同時実行シナリオ]の性能測定
```

### 3.3. Level C機能の標準フォーマット

```markdown
## X. テスト方針

### X.1 単体テスト
- **[詳細機能テスト1]**: [詳細なテストケース設計]
- **[詳細機能テスト2]**: [詳細なテストケース設計]
- **[アルゴリズムテスト]**: [特定アルゴリズム]の精度・境界値テスト
- **入力値検証**: 全パラメータの境界値・形式・組み合わせテスト
- **業務ロジック**: [複雑な業務ルール]の網羅的検証
- **エラーハンドリング**: 例外系を含む全エラーケースの処理確認
- **状態管理**: [データ状態変化]のテスト

### X.2 統合テスト
- **API エンドポイント**: [全エンドポイント]の統合テスト
- **複数システム連携**: [詳細な連携パターン]の統合確認
- **権限制御**: [全権限パターン]と例外ケースの確認
- **データベース**: [複雑なトランザクション]・整合性の確認
- **ワークフロー**: [業務フロー全体]のエンドツーエンドテスト

### X.3 パフォーマンステスト
- **負荷テスト**: [詳細な負荷パターン]での性能確認
- **ストレステスト**: [限界値テスト]での挙動確認
- **応答時間**: [詳細な基準時間]での処理完了確認
- **同時処理**: [複雑な同時実行シナリオ]の性能測定
- **リソース使用量**: [メモリ・CPU使用量]の監視・測定

### X.4 特別テスト
- **[機能固有テスト]**: [特殊な要件に応じたテスト]
- **セキュリティテスト**: [詳細なセキュリティ検証]
- **障害テスト**: [障害シミュレーション]での復旧確認
```

## 4. 機能タイプ別テスト項目

### 4.1. 参照系機能の標準テスト項目

#### 4.1.1. 必須テスト項目
- **データ取得**: 正常データの取得確認
- **フィルタリング**: 検索条件の動作確認
- **ページネーション**: ページ分割の動作確認
- **権限制御**: データアクセス権限の確認
- **パフォーマンス**: 大量データでの応答時間確認

#### 4.1.2. 追加テスト項目（Level B/C）
- **データ欠損**: 不完全データでの挙動確認
- **キャッシュ**: キャッシュ機能の動作確認
- **同時アクセス**: 複数ユーザーの同時取得処理

### 4.2. 登録系機能の標準テスト項目

#### 4.2.1. 必須テスト項目
- **データ登録**: 正常データの登録確認
- **入力値検証**: バリデーション機能の確認
- **重複チェック**: 重複データの処理確認
- **権限制御**: 登録権限の確認
- **トランザクション**: データ整合性の確認

#### 4.2.2. 追加テスト項目（Level B/C）
- **一括登録**: 複数データの同時登録確認
- **エラー回復**: 登録失敗時の復旧確認
- **業務ルール**: 複雑な業務制約の確認

### 4.3. 更新系機能の標準テスト項目

#### 4.3.1. 必須テスト項目
- **データ更新**: 正常データの更新確認
- **楽観的ロック**: 同時更新制御の確認
- **更新権限**: 権限による更新制御の確認
- **履歴管理**: 更新履歴の記録確認
- **関連データ**: 連動更新の確認

#### 4.3.2. 追加テスト項目（Level B/C）
- **部分更新**: PATCHリクエストの動作確認
- **全体更新**: PUTリクエストの動作確認
- **状態遷移**: データ状態変化の確認

### 4.4. 削除系機能の標準テスト項目

#### 4.4.1. 必須テスト項目
- **削除処理**: 正常削除の確認
- **削除権限**: 権限による削除制御の確認
- **関連データ**: 関連データへの影響確認
- **削除ログ**: 削除操作の記録確認
- **復旧**: 削除データの復旧確認

#### 4.4.2. 追加テスト項目（Level B/C）
- **物理削除**: ハードデリートの動作確認
- **論理削除**: ソフトデリートの動作確認
- **確認機能**: 削除前確認機能の動作確認

## 5. 機能別適用レベル

### 5.1. Level A適用機能
- 勤怠情報取得機能
- 位置情報登録機能

### 5.2. Level B適用機能  
- 勤怠情報登録機能
- 勤怠情報提出先取得機能
- 勤怠情報提出先登録機能
- 勤怠情報提出先更新機能
- ユーザー勤怠設定参照仕様

### 5.3. Level C適用機能
- 勤怠情報更新機能
- 勤怠情報削除機能
- 勤怠情報提出先削除機能

## 6. 実装ガイドライン

### 6.1. テスト実施方法
- **単体テスト**: Jest、Mocha等のテストフレームワーク使用
- **統合テスト**: Supertest、Postman等のAPIテストツール使用
- **パフォーマンステスト**: Artillery、k6等の負荷テストツール使用

### 6.2. テストデータ
- **正常系データ**: 実際の業務で想定される典型的なデータ
- **境界値データ**: 上限・下限値、空文字、null値等
- **異常系データ**: 不正な形式、範囲外の値等

### 6.3. テスト環境
- **開発環境**: 開発中の継続的テスト実行
- **テスト環境**: 統合テスト・パフォーマンステスト実行
- **ステージング環境**: 本番相当環境でのE2Eテスト実行

## 7. 品質確保

### 7.1. テスト記載チェックリスト
- [ ] テスト方針セクションが設けられている
- [ ] 単体テスト項目が具体的に定義されている
- [ ] 統合テスト項目が定義されている
- [ ] パフォーマンステスト項目が定義されている
- [ ] 機能レベルに応じた適切な詳細度で記載されている
- [ ] 実施可能なテスト項目が設定されている

### 7.2. テスト実装チェックリスト
- [ ] 記載されたテスト項目が実装されている
- [ ] テストカバレッジが基準値を満たしている
- [ ] テストが自動化されている
- [ ] テスト実行が継続的に行われている

## 8. 変更管理

### 8.1. テスト項目更新プロセス
1. 機能要件変更の確認
2. 影響範囲の特定
3. テスト項目の追加・修正
4. 標準文書の更新
5. 各機能設計書への反映

### 8.2. 適用レベル変更プロセス
1. 機能複雑度の再評価
2. 新しいレベルでのテスト項目適用
3. 設計書フォーマットの更新
4. テスト実装への反映

---

## 変更履歴
| 日付 | 変更者 | 変更内容 |
|-----|-------|---------|
| 2025/01/09 | カーン | 初版作成 - テスト方針記載の統一標準定義 |

※このドキュメントは課題9.9「テスト方針の記載詳細度の不統一」の対応として作成されました。
