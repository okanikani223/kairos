# 設計品質確保プロンプト戦略

## 概要

本書は、kairosプロジェクトにおいて設計書間の矛盾や記載粒度の差異を防ぐために策定されたプロンプト戦略およびカスタム指令をまとめたものです。
機能設計書の横断レビューで発見した課題を踏まえ、継続的な設計品質向上を目指します。

---

## 1. API設計統一プロンプト

### 1.1 カスタム指令: APIレスポンス形式統一

```
あなたはAPIレスポンス設計の専門家です。以下の形式でレスポンスを統一してください：

【統一レスポンス形式】
成功時:
{
  "success": true,
  "data": {実際のデータ},
  "timestamp": "ISO 8601形式"
}

エラー時:
{
  "success": false,
  "error": {
    "code": "エラーコード",
    "message": "エラーメッセージ",
    "details": "詳細情報（オプション）"
  },
  "timestamp": "ISO 8601形式"
}

【チェック項目】
✓ success フィールドが必須
✓ timestamp は ISO 8601 形式
✓ エラー時は error オブジェクト必須
✓ 成功時は data オブジェクト必須
✓ HTTPステータスコードとの対応確認

設計書に記載するAPIは必ずこの形式に従ってください。
```

### 1.2 カスタム指令: HTTPステータスコード標準化

```
あなたはHTTPステータスコード設計の専門家です。以下の標準に従ってステータスコードを設計してください：

【標準HTTPステータスコード】
- 200: 正常処理完了
- 201: リソース作成成功
- 204: 正常処理完了（レスポンスボディなし）
- 400: リクエストエラー（バリデーション等）
- 401: 認証エラー
- 403: 認可エラー
- 404: リソース未発見
- 409: 競合エラー（重複登録等）
- 422: 処理不可能エンティティ（ビジネスロジックエラー）
- 500: サーバー内部エラー

【チェック項目】
✓ CRUD操作に適切なステータスコード使用
✓ エラーレスポンスとの対応
✓ 業務固有エラーは422を使用
✓ セキュリティ考慮（404 vs 403の使い分け）
```

---

## 2. 記載粒度統一プロンプト

### 2.1 カスタム指令: 機能設計書記載粒度統一

```
あなたは機能設計書の記載品質管理者です。以下の項目を必須レベルで記載してください：

【必須記載項目】
1. 機能概要
   - 目的・背景（2-3行）
   - 対象ユーザー
   - 期待効果

2. 入出力定義
   - リクエストパラメータ（型・必須/任意・制約）
   - レスポンス構造（ネストレベルまで詳細化）
   - エラーパターン（全パターン網羅）

3. 処理フロー
   - 正常系（ステップ番号付き）
   - 異常系（エラーハンドリング含む）
   - データベースアクセスパターン

4. セキュリティ要件
   - 認証・認可要件
   - 入力値検証ルール
   - セキュリティリスクと対策

5. パフォーマンス要件
   - レスポンス時間目標
   - 同時アクセス数制限
   - リソース使用量制限

【記載品質チェック】
✓ 各項目の記載漏れなし
✓ 具体的な値・条件が明記
✓ 曖昧な表現を排除
✓ 他機能との関連性明記
```

### 2.2 カスタム指令: データモデル記載統一

```
あなたはデータモデル設計の専門家です。以下の形式でデータモデルを統一してください：

【データモデル記載形式】
```
テーブル名: table_name
目的: テーブルの役割説明

| フィールド名 | 型 | 制約 | 説明 | 例 |
|-------------|----|----- |----- |----|
| id | BIGINT | PK, AUTO_INCREMENT | 主キー | 1 |
| field_name | VARCHAR(100) | NOT NULL, UNIQUE | 説明 | "example" |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 | "2025-06-08T10:00:00Z" |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 | "2025-06-08T10:00:00Z" |

インデックス:
- PRIMARY KEY (id)
- UNIQUE KEY uk_field_name (field_name)
- KEY idx_created_at (created_at)

関連:
- 外部キー制約の説明
- 参照整合性の説明
```

【チェック項目】
✓ 全フィールドに型・制約・説明記載
✓ インデックス設計の根拠明記
✓ 外部キー関係の明示
✓ サンプルデータの提供
```

---

## 3. 段階的品質チェックプロンプト

### 3.1 自己チェックプロンプト（設計者用）

```
【設計書自己チェックリスト】

機能設計書を完成させた後、以下をチェックしてください：

□ 基本情報
  □ 機能名が明確で一意
  □ 目的・背景が具体的
  □ 対象ユーザーが明確

□ API設計
  □ エンドポイントURL記載
  □ HTTPメソッド適切
  □ リクエスト・レスポンス形式統一
  □ 全エラーパターン網羅

□ データ設計
  □ テーブル構造詳細記載
  □ インデックス設計根拠明記
  □ 外部キー関係明示

□ セキュリティ
  □ 認証・認可要件明記
  □ 入力値検証ルール詳細化
  □ セキュリティリスク分析済

□ パフォーマンス
  □ レスポンス時間目標設定
  □ 負荷条件明記
  □ スケーラビリティ考慮

□ 他機能との関連性
  □ 依存関係明記
  □ インターフェース整合性確認
  □ データ共有パターン明記

未チェック項目があれば設計書を修正してください。
```

### 3.2 レビュー実施プロンプト（レビュワー用）

```
【機能設計書レビューガイド】

以下の観点で設計書をレビューしてください：

## 1. 整合性チェック
□ API仕様の統一性
  - レスポンス形式が統一されているか
  - HTTPステータスコードが適切か
  - エラーハンドリングが統一されているか

□ データモデルの整合性
  - 他機能との重複・矛盾がないか
  - 命名規則が統一されているか
  - 外部キー関係が正しいか

## 2. 記載品質チェック
□ 必須項目の網羅性
  - 全必須項目が記載されているか
  - 記載内容が具体的か
  - 曖昧な表現がないか

□ 実装可能性
  - 技術的実現可能性
  - パフォーマンス要件の妥当性
  - セキュリティ要件の実装可能性

## 3. レビューコメント例
Good:
- "API仕様が統一形式に従っており、実装時の混乱を防げます"
- "エラーパターンが網羅的で、運用時の対応が明確です"

Improve:
- "レスポンス形式を統一形式に合わせてください（参照：API設計統一プロンプト）"
- "セキュリティ要件の記載が不足しています。認証・認可の詳細を追加してください"

Critical:
- "他機能との矛盾があります。XX機能との整合性を確認し修正してください"
- "データモデルに必須フィールドが不足しています"
```

---

## 4. 継続的品質管理プロンプト

### 4.1 定期品質監査プロンプト

```
【月次設計品質監査】

以下の手順で設計書全体の品質を監査してください：

## 1. 横断チェック項目
□ API仕様統一度
  - 全機能のレスポンス形式統一率: ____%
  - HTTPステータスコード使用統一率: ____%
  - エラーハンドリング統一率: ____%

□ 記載粒度統一度
  - 必須項目記載率: ____%
  - 具体性レベル統一率: ____%
  - 曖昧表現排除率: ____%

□ 機能間整合性
  - データモデル矛盾件数: ____件
  - インターフェース不整合件数: ____件
  - 重複機能発見件数: ____件

## 2. 品質改善アクション
発見した課題:
1. [課題内容]
   - 影響範囲: 
   - 改善方法:
   - 担当者:
   - 期限:

## 3. 次月改善目標
- 統一率目標: ____%以上
- 新規矛盾発生: ____件以下
- レビュー指摘減少率: ____%以上
```

### 4.2 プロンプト継続改善指令

```
【プロンプト戦略改善】

このプロンプト戦略自体を継続的に改善してください：

## 改善サイクル
1. 月次効果測定
   - プロンプト適用前後の品質指標比較
   - 設計者・レビュワーのフィードバック収集
   - 課題発見・解決状況の追跡

2. プロンプト更新
   - 新たに発見された課題パターンの反映
   - より効果的な表現・構造への改良
   - 新技術・手法の取り込み

3. 教育・浸透
   - プロンプト使用方法の教育
   - 成功事例の共有
   - 定期的な振り返り実施

## 改善観点
□ 実用性: プロンプトが実際に使われているか
□ 効果性: 品質向上効果が測定できているか
□ 効率性: 作業効率が向上しているか
□ 持続性: 継続的に運用できているか

## 更新履歴
| 日付 | 更新内容 | 理由 | 効果 |
|------|----------|------|------|
| 2025-06-08 | 初版作成 | 横断レビュー課題対応 | - |
```

---

## 5. プロンプト適用ガイドライン

### 5.1 段階的導入手順

1. **Phase 1: プロンプト導入準備**（1週間）
   - 全設計者へのプロンプト戦略説明
   - 既存設計書の現状分析
   - 優先適用対象の選定

2. **Phase 2: パイロット適用**（2週間）
   - 新規機能設計での適用開始
   - 適用効果の初期測定
   - プロンプトの調整・改良

3. **Phase 3: 全面展開**（1ヶ月）
   - 全新規設計書への適用
   - 既存設計書の段階的改善
   - レビュープロセスへの組み込み

4. **Phase 4: 継続改善**（継続）
   - 月次品質監査の実施
   - プロンプト戦略の継続改善
   - 新たな課題への対応

### 5.2 効果測定指標

| 指標 | 現状 | 目標 | 測定方法 |
|------|------|------|----------|
| API統一率 | - | 95%以上 | 形式チェック自動化 |
| 記載粒度統一率 | - | 90%以上 | レビュー指摘分析 |
| 機能間矛盾発生率 | - | 5件/月以下 | 横断チェック |
| レビュー効率 | - | 20%向上 | レビュー時間測定 |
| 設計者満足度 | - | 80%以上 | アンケート調査 |

---

## 6. 付録

### 6.1 よくある質問と回答

**Q: プロンプトが長すぎて覚えられません**
A: 各プロンプトをブックマークまたはテンプレート化し、必要に応じて参照してください。完全暗記は不要です。

**Q: 既存設計書への適用はどうすべきですか？**
A: 優先度の高い機能から段階的に適用し、全面改修は避けて部分的な改善を積み重ねてください。

**Q: プロンプトの効果が感じられません**
A: 1ヶ月程度の継続適用後に効果測定を行い、必要に応じてプロンプト内容を調整してください。

### 6.2 関連資料

- kairosプロジェクト_未対応課題.md（課題10.1-10.10参照）
- 各機能設計書（プロンプト適用対象）
- プロジェクト要件整理テンプレート.md

---

**作成日**: 2025年6月8日  
**作成者**: kairosプロジェクトチーム  
**版数**: v1.0
