# kairosプロジェクト 未対応課題リスト

このドキュメントは、設計書間の矛盾や未解決の課題を整理したものです。

## 対応状況一覧

| 課題ID | 課題名 | 優先度 | 対応状況 | 対応予定日 | 担当者 |
|------|------|------|--------|---------|------|
| [1.1](#11-場所を表す用語の不一致) | 場所を表す用語の不一致 | 中 | ✅ 完了（2025/06/08） | - | カーン |
| [1.2](#12-勤怠情報作成の主体の矛盾) | 勤怠情報作成の主体の矛盾 | 高 | ✅ 完了（2025/06/08） | - | カーン |
| [1.3](#13-generateoptionsパラメータの動作明確化) | generateOptionsパラメータの動作明確化 | 中 | ✅ 完了（2025/06/08） | - | カーン |
| [1.4](#14-既存設計書への用語集適用) | 既存設計書への用語集適用 | 中 | ✅ 完了（2025/06/08） | - | カーン |
| [2.1](#21-判定ロジックの不一致) | 判定ロジックの不一致 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [2.2](#22-休暇判定の記述と実装の不一致) | 休暇判定の記述と実装の不一致 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [3.1](#31-ユーザーの勤怠設定の参照不足) | ユーザーの勤怠設定の参照不足 | 高 | ✅ 完了（2025/06/08） | - | カーン |
| [4.1](#41-アクセス権限の粒度) | アクセス権限の粒度 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [5.1](#51-新規機能設計書の作成) | 新規機能設計書の作成 | 高 | ✅ 完了（2025/06/08） | - | カーン |
| [6.1](#61-共通コンポーネントの整理) | 共通コンポーネントの整理 | 低 | ✅ 完了（2025/06/09） | - | カーン |
| [7.1](#71-companyidパラメータの削除) | companyIdパラメータの削除 | 高 | ✅ 完了（2025/06/08） | - | カーン |
| [8.1](#81-勤怠情報の更新削除機能設計書の作成) | 勤怠情報の更新・削除機能設計書の作成 | 高 | ✅ 完了（2025/06/08） | - | カーン |
| [9.1](#91-apiエンドポイントの命名規則の不一致) | APIエンドポイントの命名規則の不一致 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [9.2](#92-httpステータスコードの使用基準の不統一) | HTTPステータスコードの使用基準の不統一 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [9.3](#93-レスポンス形式の構造不一致) | レスポンス形式の構造不一致 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [9.4](#94-エラーレスポンスのdetailsフィールド形式の不統一) | エラーレスポンスのdetailsフィールド形式の不統一 | 低 | ✅ 完了（2025/06/09） | - | カーン |
| [9.5](#95-勤務判定アルゴリズムの重複定義と記載粒度の違い) | 勤務判定アルゴリズムの重複定義と記載粒度の違い | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [9.6](#96-generateoptionsパラメータの記載詳細度の不一致) | generateOptionsパラメータの記載詳細度の不一致 | 低 | ✅ 完了（2025/06/09） | - | カーン |
| [9.7](#97-セキュリティ要件の記載レベルの格差) | セキュリティ要件の記載レベルの格差 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [9.8](#98-パフォーマンス要件の記載基準の不統一) | パフォーマンス要件の記載基準の不統一 | 低 | ✅ 完了（2025/06/09） | - | カーン |
| [9.9](#99-テスト方針の記載詳細度の不統一) | テスト方針の記載詳細度の不統一 | 低 | ✅ 完了（2025/01/27） | - | カーン |
| [9.10](#910-ドキュメント構造と章立ての不統一) | ドキュメント構造と章立ての不統一 | 中 | 未対応 | 未定 | - |
| [9.11](#911-非機能要件の記載範囲と詳細度の格差) | 非機能要件の記載範囲と詳細度の格差 | 中 | 未対応 | 未定 | - |
| [9.12](#912-アルゴリズムと技術実装詳細の記載基準の不一致) | アルゴリズムと技術実装詳細の記載基準の不一致 | 低 | 未対応 | 未定 | - |
| [9.13](#913-依存関係の記載レベルと分類の不統一) | 依存関係の記載レベルと分類の不統一 | 低 | 未対応 | 未定 | - |
| [9.14](#914-変更履歴の有無と記載形式の不統一) | 変更履歴の有無と記載形式の不統一 | 低 | 未対応 | 未定 | - |
| [9.15](#915-運用考慮事項と今後の拡張計画の記載格差) | 運用考慮事項と今後の拡張計画の記載格差 | 低 | 未対応 | 未定 | - |
| [10.1](#101-レスポンス形式のstatussuccessフィールドの混在) | レスポンス形式のstatus/successフィールドの混在 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [10.2](#102-セキュリティ要件の記載有無と詳細度の差) | セキュリティ要件の記載有無と詳細度の差 | 中 | 未対応 | 未定 | - |
| [10.3](#103-データモデルのフィールド必須性の記載形式不統一) | データモデルのフィールド必須性の記載形式不統一 | 低 | 未対応 | 未定 | - |
| [10.4](#104-バリデーション仕様の記載詳細度の格差) | バリデーション仕様の記載詳細度の格差 | 中 | 未対応 | 未定 | - |
| [10.5](#105-複数パターンのapiエンドポイント構成の不統一) | 複数パターンのAPIエンドポイント構成の不統一 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [10.6](#106-機能概要の記載範囲と詳細度の不一致) | 機能概要の記載範囲と詳細度の不一致 | 低 | 未対応 | 未定 | - |
| [10.7](#107-技術的実装詳細の記載有無と深度の格差) | 技術的実装詳細の記載有無と深度の格差 | 中 | ✅ 完了（2025/06/09） | - | カーン |
| [10.8](#108-クエリパラメータのデフォルト値記載の不統一) | クエリパラメータのデフォルト値記載の不統一 | 低 | 未対応 | 未定 | - |
| [10.9](#109-レスポンスのdata構造の一貫性不足) | レスポンスのdata構造の一貫性不足 | 中 | ✅ 完了（2025/01/09） | - | カーン |
| [10.10](#1010-関連データの削除無効化処理方針の不一致) | 関連データの削除・無効化処理方針の不一致 | 中 | 未対応 | 未定 | - |

## 1. 用語・概念の不一致に関する課題

### 1.1. 場所を表す用語の不一致
- **課題**: 「勤怠情報提出先(Company)」と「勤務地」という用語の統一
- **対応案**: 
  - 用語集の作成 ✅ 完了（kairosプロジェクト_用語集.md）
  - 各設計書での用語統一 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（用語集作成完了、各設計書の用語統一完了）

### 1.2. 勤怠情報作成の主体の矛盾
- **課題**: 「自動勤怠情報作成」機能の独立性と実装方法
- **対応案**: 
  - 機能の明確な分離 ✅ 完了
  - 自動勤怠情報作成機能の詳細設計書作成 ✅ 完了（勤怠情報登録機能_機能設計.md）
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能として統合設計完了）

### 1.3. generateOptionsパラメータの動作明確化
- **課題**: `autoGenerate: true`で`generateOptions`が省略された場合の動作が不明確
- **対応案**: 
  - デフォルト値の明確化 ✅ 完了
  - 省略時の動作説明追加 ✅ 完了
  - エラーハンドリングの詳細化 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能_機能設計.mdでデフォルト値動作とエラーハンドリング明確化）

### 1.4. 既存設計書への用語集適用
- **課題**: 既存の設計書で用語集と異なる用語が混在している
- **対応案**: 
  - 各機能設計書の用語を用語集に合わせて修正 ✅ 完了
  - 統一された用語での再レビュー実施 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（全機能設計書の用語統一完了）

## 2. 自動勤怠情報作成のロジック課題

### 2.1. 判定ロジックの不一致
- **課題**: 位置情報登録機能の「距離計算アルゴリズム」と勤怠情報取得機能の「勤務判定アルゴリズム」の関係が不明確
- **対応案**: 
  - アルゴリズム関係の明確化 ✅ 完了（勤怠情報登録機能で統合定義）
  - 共通ライブラリの定義 ✅ 完了（勤怠情報登録機能で包括的に定義済み）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 勤怠情報登録機能設計書にて距離計算アルゴリズム（Haversine公式）、勤務判定アルゴリズム、休暇自動判定ロジックの詳細実装を統合定義
  - 各機能間でのアルゴリズム参照関係を明確化
  - 用語集にて判定・計算関連用語を体系化

### 2.2. 休暇判定の記述と実装の不一致
- **課題**: 休暇判定ロジックがどこで実装されるか不明確
- **対応案**: 
  - 処理フローの詳細化 ✅ 完了（勤怠情報登録機能で定義）
  - コンポーネント分割と責務の明確化 ✅ 完了（コンポーネント分割設計書作成）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 勤怠情報登録機能にて休暇判定の処理フロー詳細化完了
  - 共通ライブラリ設計書にて休暇判定ロジックのコンポーネント化を定義
  - コンポーネント分割と責務明確化設計書にて各層の責務を明確化

## 3. 新しい機能への対応課題

### 3.1. ユーザーの勤怠設定の参照不足
- **課題**: 新たに追加された「ユーザーの勤怠設定(UserAttendanceSetting)」モデルの参照方法が不明確
- **対応案**: 
  - 具体的な参照関係の明記 ✅ 完了（勤怠情報登録機能で使用方法定義）
  - 機能間の連携フローの図示 ✅ 完了（専用設計書で詳細化）
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/08）
- **完了内容**: 
  - `ユーザー勤怠設定参照仕様_機能設計.md`を新規作成
  - 全機能設計書での参照方法と依存関係を明確化
  - 機能間連携フローをmermaid図で可視化

## 4. セキュリティ要件の整合性課題

### 4.1. アクセス権限の粒度
- **課題**: 「権限を付与された者」の定義や権限管理の方法が不明確
- **対応案**: 
  - アクセス権限マトリクスの作成 ✅ 完了（アクセス権限管理設計書作成）
  - 権限付与の仕組みの明確化 ✅ 完了（役割ベースアクセス制御システム設計）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - `アクセス権限管理設計書.md`を新規作成
  - 5つの基本役割（User、Manager、Admin、HR、Auditor）を定義
  - 機能別・データ別アクセス権限マトリクスを策定
  - JWT ベース認証・認可システムの実装指針確立
  - Row Level Security による DB レベル権限制御設計
  - 権限管理運用プロセス・監査機能の定義

## 5. 自動勤怠情報作成機能の独立設計

### 5.1. 新規機能設計書の作成
- **課題**: 「自動勤怠情報作成機能」の詳細設計がない
- **対応案**: 
  - 「自動勤怠情報作成機能_機能設計.md」の新規作成 ✅ 完了（勤怠情報登録機能として統合）
  - APIエンドポイントの設計 ✅ 完了
  - 処理フローの詳細化 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能に統合済み）

## 6. その他の課題

### 6.1. 共通コンポーネントの整理
- **課題**: 複数の機能で使用される共通ロジック（勤怠判定、休暇判定など）の管理方法が不明確
- **対応案**: 
  - 共通ライブラリ設計書の作成 ✅ 完了（共通ライブラリ設計書.md作成）
  - 責務の分割と依存関係の明確化 ✅ 完了（コンポーネント分割設計書作成）
- **優先度**: 低
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 共通ライブラリ設計書を新規作成し、アルゴリズム・バリデーション等の共通機能を体系化
  - コンポーネント分割と責務明確化設計書を作成し、各層・各コンポーネントの責務と依存関係を明確化
  - 複数機能で使用される共通ロジックの管理方法を確立

---

## 新規追加された課題

### 7.1. companyIdパラメータの削除
- **課題**: 勤怠情報提出先（Company）機能が保留のため、自動生成時のcompanyIdパラメータを削除する必要がある
- **対応案**: 
  - API仕様からcompanyIdパラメータ削除 ✅ 完了
  - アルゴリズム関数をuserSettings参照に変更 ✅ 完了
  - 依存関係の更新 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能からcompanyId関連削除完了）

### 8.1. 勤怠情報の更新・削除機能設計書の作成
- **課題**: 勤怠情報の更新機能と削除機能の機能設計書が未作成
- **対応案**: 
  - 勤怠情報更新機能の機能設計書作成 ✅ 完了
  - 勤怠情報削除機能の機能設計書作成 ✅ 完了
  - 要件整理ドキュメントの状態更新 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（更新・削除機能の設計書作成完了）

### 9.1. APIエンドポイントの命名規則の不一致
- **課題**: 各機能でAPIエンドポイントの命名パターンに一貫性がない
- **詳細**: 
  - 登録機能: `POST /api/v1/attendances`
  - 取得機能: `GET /api/v1/attendances`, `GET /api/v1/attendances/{year}`, `GET /api/v1/attendances/{year}/{month}`
  - 更新機能: `PUT /api/v1/attendances/{attendanceId}`, `PATCH /api/v1/attendances/{attendanceId}`, `PATCH /api/v1/attendances/{attendanceId}/details/{detailId}`
  - 削除機能: `DELETE /api/v1/attendances/{attendanceId}`, `DELETE /api/v1/attendances/{attendanceId}/details/{detailId}`, `PATCH /api/v1/attendances/{attendanceId}/disable`
- **対応案**: 
  - RESTful APIの標準パターンに統一 ✅ 完了（API設計統一ガイドライン作成）
  - リソース識別子の命名規則を明確化 ✅ 完了（ケバブケース、複数形使用等の統一基準策定）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - `API設計統一ガイドライン.md`にてRESTful API標準パターンを定義
  - エンドポイント命名規則（複数形、ケバブケース、階層制限）を明確化
  - 全機能の統一エンドポイント体系を策定

### 9.2. HTTPステータスコードの使用基準の不統一
- **課題**: 同様のエラー状況で異なるHTTPステータスコードが使用されている
- **詳細**: 
  - 取得機能: 勤怠情報が存在しない場合のステータスコードが404で明記
  - 更新・削除機能: 同様の状況でのステータスコードは明記されているが、統一性の検証が必要
  - 登録機能: 重複データエラーで409 Conflictを使用
- **対応案**: 
  - 各エラーシナリオに対するHTTPステータスコードの統一基準を作成 ✅ 完了（API設計統一ガイドライン作成）
  - 全機能設計書でのステータスコード見直し ✅ 完了（統一基準適用）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - HTTPステータスコード統一基準を策定（200/201/204/400/401/403/404/409/422/500/503）
  - エラーシナリオ別ステータスコードマッピングを定義
  - 各操作における適切なステータスコード使用指針を明確化

### 9.3. レスポンス形式の構造不一致
- **課題**: 機能間でレスポンスJSONの構造に違いがある
- **詳細**: 
  - 取得機能: `attendances`配列でデータを返却
  - 登録・更新機能: `attendance`オブジェクトでデータを返却
  - 削除機能: `data`オブジェクト内に詳細情報を格納
- **対応案**: 
  - 共通レスポンス形式の定義 ✅ 完了（API設計統一ガイドライン作成）
  - APIレスポンススキーマの統一 ✅ 完了（統一レスポンス形式策定）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 統一レスポンス形式を定義（success、data、meta構造）
  - 単一/複数リソース返却パターンを標準化
  - ページネーション、エラーレスポンス形式を統一

### 9.4. エラーレスポンスのdetailsフィールド形式の不統一
- **課題**: エラーレスポンスの`details`フィールドで異なるデータ形式が使用されている
- **詳細**: 
  - 登録機能: `details`は配列形式で複数のフィールドエラーを格納
  - 更新機能: 同様に配列形式
  - 削除機能: `details`は文字列形式で単一の説明を格納
- **対応案**: 
  - エラーレスポンスの共通スキーマ定義 ✅ 完了
  - `details`フィールドの形式統一（配列形式に統一を推奨） ✅ 完了
- **優先度**: 低
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - レスポンスデータ構造統一標準にdetailsフィールド統一仕様を追加
  - 配列形式への統一方針を明確化（単一エラーでも配列形式）
  - 非推奨パターン（文字列形式、オブジェクト形式）の明記
  - TypeScript型定義でdetails配列形式を明確に指定
  - 検証ルール・チェックリストにdetailsフィールド形式確認を追加
  - レスポンス生成ヘルパーで配列形式の使用例を提供

### 9.5. 勤務判定アルゴリズムの重複定義と記載粒度の違い
- **課題**: 複数の機能設計書で勤務判定アルゴリズムが異なる粒度で定義されている
- **詳細**: 
  - 登録機能: 距離計算アルゴリズム（Haversine公式）、勤務判定、休暇自動判定の詳細実装コードまで記載
  - 取得機能: 勤務判定アルゴリズムの概要のみ記載、実装詳細なし
  - 更新機能: 自動再生成時に登録機能のアルゴリズムを使用すると記載されているが詳細なし
- **対応案**: 
  - 共通アルゴリズムライブラリとして別文書に切り出し
  - 各機能設計書からは共通ライブラリを参照する形式に変更
  - 記載粒度を統一（概要 + 共通ライブラリ参照）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - `勤務判定アルゴリズム統一標準.md`の既存文書を活用し、統一アルゴリズム仕様を整備
  - 距離計算（Haversine公式）、勤務地判定、勤務時間判定、休暇自動判定の4アルゴリズムを3レベル（概念・ロジック・実装）で標準化
  - `勤怠情報登録機能_機能設計.md`のセクション4を統一標準への参照形式に変更（距離計算、勤務判定、休暇自動判定）
  - `勤怠情報取得機能_機能設計.md`のセクション5を統一標準への参照形式に変更（勤務判定、休暇判定）
  - 位置情報登録機能と勤怠情報更新機能については、既存記載が統一標準に準拠していることを確認
  - 各機能設計書で統一された参照形式（参照先・用途・処理概要・適用条件）を採用

### 9.6. generateOptionsパラメータの記載詳細度の不一致
- **課題**: generateOptionsの取り扱いについて機能間で記載詳細度に差がある
- **詳細**: 
  - 登録機能: generateOptionsのデフォルト値、省略時の動作、各オプションの詳細な挙動説明
  - 更新機能: generateOptionsは自動再生成時に使用されると記載されているが、詳細説明なし
- **対応案**: 
  - generateOptionsの仕様を共通定義として別文書に作成
  - 各機能から共通定義を参照
- **優先度**: 低
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 既存の「generateOptions統一仕様.md」を活用し、各機能設計書での参照形式を統一
  - 勤怠情報登録機能・更新機能・ユーザー勤怠設定参照仕様の各書類でのgenerateOptions記載を詳細化
  - 統一仕様への参照リンクを階層化し、パラメータ定義・動作仕様・バリデーション仕様への直接参照を追加
  - 記載詳細度を統一し、基本仕様・パラメータ詳細・動作制御・バリデーションの4項目で構造化

### 9.7. セキュリティ要件の記載レベルの格差
- **課題**: 各機能でセキュリティ要件の記載詳細度が大きく異なる
- **詳細**: 
  - 登録機能: 基本的なアクセス権限のみ記載
  - 取得機能: 権限管理、バージョン管理まで言及
  - 更新機能: JWT認証、楽観的ロック、監査ログ等の詳細記載
  - 削除機能: 認証・認可、削除権限制御の詳細JSON例まで記載
- **対応案**: 
  - 共通セキュリティ要件文書の作成
  - 各機能固有のセキュリティ要件と共通要件の分離
  - 記載粒度の統一
- **優先度**: 中
- **担当者**: 未割当

### 9.8. パフォーマンス要件の記載基準の不統一
- **状況**: 完了（2025/06/09）
- **課題**: パフォーマンス要件の記載がある機能とない機能がある
- **詳細**: 
  - 登録機能: 自動生成処理の応答時間（5秒以内）、位置情報処理件数（最大1000件）
  - 取得機能: パフォーマンス要件の記載なし ✅ Level A標準フォーマットで追加
  - 更新機能: 各更新タイプの詳細な応答時間目標、同時処理要件
  - 削除機能: パフォーマンス要件の記載なし ✅ Level B標準フォーマットで追加
- **対応結果**: 
  - パフォーマンス要件記載標準を作成 ✅ 完了
  - 全10機能でパフォーマンス要件セクションを統一 ✅ 完了
  - Level A/B/C別の標準フォーマット適用 ✅ 完了
- **優先度**: 低
- **担当者**: カーン

### 9.9. テスト方針の記載詳細度の不統一
- **状況**: 完了（2025/01/27）
- **課題**: 各機能でテスト方針の記載詳細度が異なる
- **詳細**: 
  - 登録機能: 単体テスト、統合テスト、パフォーマンステストの詳細項目
  - 取得機能: テスト項目の概要のみ
  - 更新機能: 単体テスト、統合テスト、パフォーマンステストの詳細項目
  - 削除機能: テスト方針の記載なし
- **対応案**: 
  - 統一されたテスト方針テンプレートの作成
  - 各機能での必須テスト項目の標準化
- **優先度**: 低
- **担当者**: カーン
- **完了内容**: 
  - **テスト方針記載標準.md** に基づく統一フォーマット適用完了
  - **Level A/B/C別テストレベル定義** を全機能に適用
  - **対象機能**:
    - 位置情報登録機能: Level A標準フォーマット適用
    - 勤怠情報登録機能: Level B標準フォーマット適用  
    - 勤怠情報更新機能: Level C標準フォーマット適用
    - 勤怠情報削除機能: 「テスト戦略」→「テスト方針」変更、Level C標準フォーマット適用
    - 勤怠情報提出先登録・取得・更新機能: Level B標準フォーマット適用
    - 勤怠情報提出先削除機能: 「テスト戦略」→「テスト方針」変更、Level C標準フォーマット適用
    - ユーザー勤怠設定参照仕様: テスト方針セクション新規追加、Level B標準フォーマット適用
  - **テスト項目標準化**: 単体・統合・パフォーマンス・セキュリティ・障害・ユーザビリティテストの各項目を機能レベルに応じて詳細化

### 9.10. ドキュメント構造と章立ての不統一
- **状況**: 完了（2025/06/09）
- **課題**: 機能設計文書の章立て構造が機能によって大きく異なる
- **詳細**: 
  - 登録機能: 10章構成（機能概要、API仕様、機能詳細、アルゴリズム詳細、非機能要件、エラーハンドリング、拡張性考慮事項、テスト方針、依存関係、変更履歴）
  - 取得機能: 7章構成（機能概要、API仕様、機能詳細、非機能要件、技術的実装詳細、拡張性考慮事項、テスト方針）
  - 更新機能: 9章構成（機能概要、API仕様、機能詳細、セキュリティ要件、パフォーマンス要件、エラーハンドリング、テスト方針、依存関係、変更履歴）
  - 削除機能: 12章構成（機能概要、API仕様、削除パターン別仕様、セキュリティ要件、エラーハンドリング、パフォーマンス要件、監査・ログ、処理フロー、テスト戦略、依存関係、運用考慮事項、今後の拡張計画）
  - 位置情報登録機能: 7章構成（機能概要、API仕様、機能詳細、非機能要件、技術的実装詳細、拡張性考慮事項、テスト方針）
- **対応案**: 
  - 機能設計書の統一テンプレートの作成
  - 必須章とオプション章の明確化
  - 記載粒度の標準化
- **優先度**: 中
- **担当者**: 完了
- **完了内容**: 
  - **ドキュメント構造統一標準.md** を新規作成
  - Level A（概要設計書）、Level B（機能設計書）、Level C（標準・ガイドライン）の3分類と標準構造を定義
  - 章立て詳細規則、セクション記載ガイドライン、相互参照・リンク規則を策定
  - バージョン管理・更新規則とチェックリストを整備
  - 既存文書への適用指針を明確化

### 9.11. 非機能要件の記載範囲と詳細度の格差
- **課題**: 非機能要件の章名、扱う範囲、記載詳細度が機能によって大きく異なる
- **詳細**: 
  - 登録機能: 「機能特有の非機能要件」（セキュリティ、データ整合性、パフォーマンス）
  - 取得機能: 「機能特有の非機能要件」（セキュリティ、エラー処理）
  - 更新機能: 「セキュリティ要件」「パフォーマンス要件」として分離
  - 削除機能: 「セキュリティ要件」「パフォーマンス要件」として分離
  - 位置情報登録機能: 「機能特有の非機能要件」（セキュリティ、プライバシー）
- **対応案**: 
  - 非機能要件の記載標準化（章名と扱う範囲の統一）
  - 機能特有の要件と共通要件の明確な区分
- **優先度**: 中
- **担当者**: 未割当

### 9.12. アルゴリズムと技術実装詳細の記載基準の不一致
- **課題**: 技術実装詳細やアルゴリズムの記載がある機能とない機能がある
- **詳細**: 
  - 登録機能: 「自動勤怠情報作成アルゴリズム詳細」章で詳細な実装コードまで記載
  - 取得機能: 「技術的実装詳細」章でアルゴリズム概要のみ記載
  - 更新機能: 機能詳細内で部分的な実装コード例を記載
  - 削除機能: 処理フローはMermaid図で記載、実装詳細なし
  - 位置情報登録機能: 「技術的実装詳細」章で距離計算アルゴリズムの実装コードを記載
- **対応案**: 
  - 実装詳細の記載レベル基準を設定（概要のみ、疑似コード、実装コード）
  - アルゴリズム詳細は共通ライブラリとして別文書化を推奨
- **優先度**: 低
- **担当者**: 未割当

### 9.13. 依存関係の記載レベルと分類の不統一
- **課題**: 依存関係の記載レベルと分類方法が機能によって異なる
- **詳細**: 
  - 登録機能: 「システム内依存」「外部依存」で分類、具体的なAPI名・ライブラリ名を記載
  - 取得機能: 依存関係の記載なし
  - 更新機能: 「システム内依存」「外部依存」で分類、詳細な依存内容を記載
  - 削除機能: 「内部システム依存」「外部システム依存」で分類、サービス単位で記載
  - 位置情報登録機能: 依存関係の記載なし
- **対応案**: 
  - 依存関係の分類基準を統一（内部/外部、機能/技術など）
  - 記載必須レベルの設定（全機能で基本的な依存関係は記載）
- **優先度**: 低
- **担当者**: 未割当

### 9.14. 変更履歴の有無と記載形式の不統一
- **課題**: 変更履歴があるドキュメントとないドキュメントがある
- **詳細**: 
  - 登録機能: 変更履歴あり（日付、変更者、変更内容のテーブル形式）
  - 取得機能: 変更履歴なし
  - 更新機能: 変更履歴あり（同様のテーブル形式）
  - 削除機能: 変更履歴なし
  - 位置情報登録機能: 変更履歴なし
- **対応案**: 
  - 全機能設計書で変更履歴を必須とする
  - 変更履歴の記載形式を統一
- **優先度**: 低
- **担当者**: 未割当

### 9.15. 運用考慮事項と今後の拡張計画の記載格差
- **課題**: 運用面や将来の拡張についての記載が一部の機能のみに限定されている
- **詳細**: 
  - 登録機能: 「拡張性考慮事項」章あり（将来拡張、制限事項）
  - 取得機能: 「拡張性考慮事項」章あり（概要のみ）
  - 更新機能: 拡張や運用考慮事項の記載なし
  - 削除機能: 「運用考慮事項」「今後の拡張計画」章あり（詳細な記載）
  - 位置情報登録機能: 「拡張性考慮事項」章あり（概要のみ）
- **対応案**: 
  - 全機能で拡張性考慮事項の記載を標準化
  - 運用面での考慮事項が必要な機能の基準を設定
- **優先度**: 低
- **担当者**: 未割当

## 新たに発見された課題（2025年6月8日 機能設計書横断レビュー）

### 10.1. レスポンス形式のstatus/successフィールドの混在
- **課題**: 一部の機能で「status」フィールド、他の機能で「success」フィールドを使用している不統一
- **該当機能**: 
  - status使用: 勤怠情報提出先関連機能（登録・取得・更新・削除）
  - success使用: 勤怠情報関連機能（登録・取得・更新・削除）、位置情報登録機能
- **対応案**: 
  - レスポンス形式の統一方針を決定 ✅ 完了（successフィールドに統一）
  - 全機能設計書でのレスポンス形式統一 ✅ 完了（API設計統一ガイドライン適用）
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - 全APIレスポンスで`success`フィールドを統一使用
  - `status`フィールドの廃止とマイグレーション指針策定
  - 統一レスポンス形式における`success: true/false`の明確な使用基準設定

### 10.2. セキュリティ要件の記載有無と詳細度の差
- **課題**: 位置情報登録機能では詳細なセキュリティ・プライバシー要件が記載されているが、他機能では基本的な認証要件のみ
- **該当機能**: 
  - 詳細記載: 位置情報登録機能（プライバシー要件、データ保持期間制限）
  - 基本記載: その他の機能（認証要件のみ）
- **対応案**: 
  - セキュリティ要件の記載基準を統一
  - 全機能での必要なセキュリティ要件の整理と追記
- **優先度**: 中
- **担当者**: 未割当

### 10.3. データモデルのフィールド必須性の記載形式不統一
- **課題**: 必須フィールドの表記方法が機能により異なる
- **該当差異**: 
  - 「必須」欄使用: 勤怠情報提出先関連機能
  - 「必須」フィールド使用: 勤怠情報関連機能
  - 記載なし: 位置情報登録機能
- **対応案**: 
  - 必須性表記方法の統一
  - 全機能設計書での記載形式統一
- **優先度**: 低
- **担当者**: 未割当

### 10.4. バリデーション仕様の記載詳細度の格差
- **課題**: バリデーション仕様の記載詳細度が機能により大きく異なる
- **該当差異**: 
  - 詳細記載: 勤怠情報提出先関連機能（文字数制限、範囲指定、形式指定）
  - 基本記載: 勤怠情報関連機能（基本的な型チェックのみ）
  - 最低限記載: 位置情報登録機能（範囲チェックのみ）
- **対応案**: 
  - バリデーション仕様の記載基準策定
  - 各機能での必要なバリデーション仕様の整理と統一
- **優先度**: 中
- **担当者**: 未割当

### 10.5. 複数パターンのAPIエンドポイント構成の不統一
- **課題**: 同一機能内でのエンドポイント設計パターンが不統一
- **該当差異**: 
  - RESTful設計: 勤怠情報提出先関連機能
  - 複合パターン: 勤怠情報関連機能（CRUD + カスタムエンドポイント混在）
  - シンプル設計: 位置情報登録機能
- **対応案**: 
  - エンドポイント設計パターンの統一
  - 設計ガイドラインの策定
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/09）
- **完了内容**: 
  - `APIエンドポイント構成統一標準.md`を作成
  - 3レベルのパターン分類体系を確立（基本RESTful、階層リソース、業務特化）
  - 機能複雑度による適用基準を明確化（シンプル・標準・複合機能）
  - パターン選択基準とチェックリストを策定
  - 機能分類別の統一エンドポイント構成を定義
  - 機能設計書記載統一基準を策定（セクション構成、記載項目、レスポンス形式）
  - 段階的適用計画と品質確保プロセスを整備

### 10.6. 機能概要の記載範囲と詳細度の不一致
- **課題**: 機能概要の記載内容と詳細度が機能により大きく異なる
- **該当差異**: 
  - 簡潔: 位置情報登録機能（基本的な目的のみ）
  - 中程度: 勤怠情報提出先関連機能（基本目的 + 主要機能）
  - 詳細: 勤怠情報関連機能（目的 + 主要機能 + 制約事項）
- **対応案**: 
  - 機能概要の記載基準策定
  - 全機能での記載内容統一
- **優先度**: 低
- **担当者**: 未割当

### 10.7. 技術的実装詳細の記載有無と深度の格差
- **課題**: 技術的実装詳細の記載有無と深度が機能により大きく異なる
- **該当差異**: 
  - 詳細記載: 位置情報登録機能（アルゴリズム実装例、データ連携仕様）
  - 基本記載: 勤怠情報関連機能（概要レベルの技術説明）
  - 記載なし: 勤怠情報提出先関連機能
- **対応案**: 
  - 技術的実装詳細の記載基準策定
  - 必要な実装詳細の整理と記載統一
- **優先度**: 中
- **担当者**: 未割当
- **ステータス**: ✅ **完了（2025/06/09）**
- **完了詳細**: 
  - **技術的実装詳細記載標準.md**を作成し、3段階の記載レベル（Level A: 概要記載、Level B: 仕様記載、Level C: 実装記載）を定義
  - 機能複雑度による分類（Simple/Standard/Complex）と記載レベルの対応を明確化
  - アルゴリズム実装、データ処理実装、連携仕様実装、パフォーマンス実装の各カテゴリを体系化
  - 機能設計書と共通ライブラリ設計書の責務分離を明確化し、参照関係記載標準を策定
  - 段階的適用計画（4フェーズ、8週間）と実装品質チェックリストを提供

### 10.8. クエリパラメータのデフォルト値記載の不統一
- **課題**: クエリパラメータのデフォルト値記載有無が不統一
- **該当差異**: 
  - デフォルト値記載: 勤怠情報提出先取得機能
  - デフォルト値記載なし: 勤怠情報取得機能、その他の機能
- **対応案**: 
  - デフォルト値記載の統一基準策定
  - 全機能での記載統一
- **優先度**: 低
- **担当者**: 未割当

### 10.9. レスポンスのdata構造の一貫性不足
- **課題**: 成功レスポンスでのdata構造の包含方法が不統一
- **該当差異**: 
  - data.companies、data.company: 勤怠情報提出先関連機能
  - 直接配列/オブジェクト: 勤怠情報関連機能
  - シンプル構造: 位置情報登録機能
- **対応案**: 
  - レスポンス構造の統一方針決定
  - 全機能でのレスポンス構造統一
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/01/09）
- **完了内容**: 
  - レスポンスデータ構造統一標準を作成
  - success/statusフィールドの統一（successフィールドに統一）
  - データ包含パターンの標準化（単一リソース、複数リソース、階層リソース）
  - HTTPステータスコード別レスポンス仕様の策定
  - エラーコード・メッセージ統一仕様の確立
  - TypeScript型定義とヘルパー関数の提供
  - 段階的移行計画（3フェーズ、6週間）と品質確保チェックリストを提供

### 10.10. 関連データの削除・無効化処理方針の不一致
- **課題**: 関連データがある場合の削除・無効化処理方針が機能により異なる
- **該当差異**: 
  - 複数削除方式: 勤怠情報削除機能（物理削除・論理削除・確認機能）
  - 関連チェック: 勤怠情報提出先削除機能（関連データ存在時エラー + 強制削除オプション）
- **対応案**: 
  - 削除・無効化処理方針の統一
  - 関連データ処理ガイドラインの策定
- **優先度**: 中
- **担当者**: 未割当

---

## 対応完了サマリー（2025年06月09日更新）

### 完了済み課題（17件）
1. **1.1**: 場所を表す用語の不一致 ✅ 完了（2025/06/08）
2. **1.2**: 勤怠情報作成の主体の矛盾 ✅ 完了（2025/06/08）
3. **1.3**: generateOptionsパラメータの動作明確化 ✅ 完了（2025/06/08）
4. **1.4**: 既存設計書への用語集適用 ✅ 完了（2025/06/08）
5. **2.1**: 判定ロジックの不一致 ✅ 完了（2025/06/09）
6. **2.2**: 休暇判定の記述と実装の不一致 ✅ 完了（2025/06/09）
7. **3.1**: ユーザーの勤怠設定の参照不足 ✅ 完了（2025/06/08）
8. **4.1**: アクセス権限の粒度 ✅ 完了（2025/06/09）
9. **5.1**: 新規機能設計書の作成 ✅ 完了（2025/06/08）
10. **6.1**: 共通コンポーネントの整理 ✅ 完了（2025/06/09）
11. **7.1**: companyIdパラメータの削除 ✅ 完了（2025/06/08）
12. **8.1**: 勤怠情報の更新・削除機能設計書の作成 ✅ 完了（2025/06/08）
13. **9.1**: APIエンドポイントの命名規則の不一致 ✅ 完了（2025/06/09）
14. **9.2**: HTTPステータスコードの使用基準の不統一 ✅ 完了（2025/06/09）
15. **9.3**: レスポンス形式の構造不一致 ✅ 完了（2025/06/09）
16. **9.4**: エラーレスポンスのdetailsフィールド形式の不統一 ✅ 完了（2025/06/09）
17. **10.1**: レスポンス形式のstatus/successフィールドの混在 ✅ 完了（2025/06/09）

### 未対応課題（16件）
- **9.5-9.15**: API・設計書の統一性に関する課題（11件）
- **10.2-10.10**: 機能横断レビューで発見された課題（9件）

### 今回の対応（2025/06/09）
**課題9.4「エラーレスポンスのdetailsフィールド形式の不統一」の完了対応**:
1. **レスポンスデータ構造統一標準.md** の更新
   - detailsフィールド統一仕様を追加（常に配列形式）
   - 非推奨パターン（文字列形式、オブジェクト形式）の明記
   - TypeScript型定義でdetails配列形式を明確に指定
   - 検証ルール・チェックリストにdetailsフィールド形式確認を追加
   - レスポンス生成ヘルパーで配列形式の使用例を提供

2. **未対応課題リスト** の更新
   - 課題9.4を「未対応」から「✅ 完了（2025/06/09）」に変更
   - 完了内容の詳細記載
   - 完了済み課題数の更新（15件→17件）

これにより、**エラーレスポンスのdetailsフィールド形式の統一が完了**し、全てのAPIで配列形式の使用が標準化されました。
1. **共通ライブラリ設計書.md** を新規作成
   - 勤務判定・距離計算・休暇判定アルゴリズムの統一定義
   - バリデーション・ユーティリティの共通化
   - アルゴリズム実装コードと使用方法の詳細化

2. **コンポーネント分割と責務明確化設計書.md** を新規作成
   - 全層（プレゼンテーション・アプリケーション・ビジネスロジック・データアクセス）の責務定義
   - コンポーネント間依存関係の明確化
   - データフロー・エラーハンドリング・セキュリティ責務の体系化

3. **未対応課題リスト** の更新
   - 課題2.2を「部分対応」から「完了」に変更
   - 課題6.1を「部分対応」から「完了」に変更
   - 完了内容の詳細記載

これにより、**部分対応状態の課題がすべて解決**され、基本的な設計課題は完了状態となりました。

---

※このドキュメントは開発の進行に合わせて随時更新されます。
