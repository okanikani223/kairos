# kairosプロジェクト要件整理

## 1. プロジェクト概要
```
プロジェクト名：kairos
開発者：カーン
目的：勤怠情報の自動的な記録と複数提出先に対応した勤怠管理の効率化
概要：位置情報を活用して自動的に勤怠情報を記録・管理し、複数の提出先に合わせたフォーマットで出力できる勤怠管理システム
展開国：日本国内のみ
```

## 2. 解決する課題
```
- 課題1：勤怠記録の煩雑さ
  - 詳細：毎日の勤怠情報の記録が手作業で煩雑である
  - 現状：毎日記録せず、提出期限の数日前にまとめて記録している
  - 理想：位置情報を活用した自動的な勤怠記録で手入力をなくす

- 課題2：複数提出先への対応
  - 詳細：提出先毎に集計期間や様式が異なる
  - 現状：所属企業（15日締め）、作業現場（月末締め、Redmineと週毎Excel）、仲介会社（月末締め、Web入力）と複数ある
  - 理想：一元的に管理した情報から各提出先のフォーマットに合わせて出力できる

- 課題3：時間のかかる集計作業
  - 詳細：提出先によって日毎、週毎の集計や、サマリ情報が必要
  - 現状：手作業で集計し、それぞれのフォーマットに合わせて入力している
  - 理想：システムが自動的に集計し、必要なフォーマットに出力できる
```

## 3. 主要機能一覧

### 必須機能（MVP）
| 機能名 | 説明 | 優先度 | 状態 |
|------|-----|-------|-----|
| 位置情報登録 | スマホやPCからの位置情報登録機能 | 高 | 未着手 |
| 勤怠情報提出先管理 | 各提出先の情報と規定時刻の管理 | 高 | 未着手 |
| 自動勤怠情報作成 | 位置情報から勤怠情報を自動的に生成 | 高 | 未着手 |
| 勤怠情報CRUD | 勤怠情報の登録・取得・更新・削除機能 | 高 | 未着手 |
| 勤怠情報サマリ | 月次の勤怠集計と表示 | 高 | 未着手 |

### 追加機能（将来実装）
| 機能名 | 説明 | 優先度 | 状態 |
|------|-----|-------|-----|
| フォーマット出力 | 各提出先のフォーマットに合わせた出力機能 | 中 | 未着手 |
| 休暇管理 | 有給・代休・特別休暇の管理機能 | 中 | 未着手 |

## 4. データモデル
```
- 勤怠情報提出先(Company)：
  - 属性：
    - id: UUID
    - companyName: String (会社名)
    - location: {latitude: String, longitude: String} (位置情報)
    - regulationStartTime: String (規定勤怠開始時刻)
    - regulationEndTime: String (規定勤怠終了時刻)
    - regulationRestStartTime: String (規定休憩開始時刻)
    - regulationRestEndTime: String (規定休憩終了時刻)
    - affiliationStartDate: Date (所属開始日)
    - affiliationEndDate: Date (所属終了日)

- 位置情報(Location)：
  - 属性：
    - id: UUID
    - userId: UUID (位置情報を登録したユーザーID)
    - latitude: String (緯度)
    - longitude: String (経度)
    - accuracy: Number (精度、メートル単位、任意)
    - at: DateTime (登録日時)

- 勤怠情報(Attendance)：
  - 属性：
    - id: UUID
    - yearMonth: String (提出年月)
    - companyId: UUID (提出先ID)
    - details: AttendanceDetail[] (勤怠詳細)
    - summary: {
        totalWorkDays: String,
        totalPaidLeaveDays: String,
        totalCompensatoryDays: String,
        totalSpecialLeaveDays: String,
        totalWorkHours: String,
        totalOverHours: String,
        totalHolidayWorkHours: String
      } (サマリ情報)

- 日毎の勤怠情報(AttendanceDetail)：
  - 属性：
    - id: UUID
    - attendanceId: UUID (関連する勤怠情報ID)
    - date: Date (日付)
    - holiday: Boolean (休日フラグ)
    - leave: String (休暇種別)
    - startDateTime: DateTime (勤怠開始時刻)
    - endDateTime: DateTime (勤怠終了時刻)
    - restHour: String (休憩時間)
    - workHour: String (勤務時間)
    - overHour: String (残業時間)
    - note: String (備考)
    - locationIds: UUID[] (関連する位置情報ID)
```

## 5. 非機能要件

### 5.1 パフォーマンス要件
```
- API応答時間: 平均500ms以内
- 同時リクエスト処理: 最大100リクエスト/秒
- データ取得・検索レスポンス: 1秒以内
```

### 5.2 セキュリティ要件
```
- 通信は必ずHTTPS（TLS 1.2以上）で行う
- API認証: JWT認証必須
- 位置情報データは暗号化して保存
- パスワードはハッシュ化して保存（bcryptなど）
- セッションタイムアウト: 30分
```

### 5.3 可用性要件
```
- システム稼働率: 99.9%（月間ダウンタイム約43分以内）
- バックアップ: 日次
- 障害復旧時間: 1時間以内（RTO）
- データ損失許容範囲: 15分以内（RPO）
```

## 6. 課題・検討事項
```
- 課題1：位置情報の精度と信頼性
  - 詳細：GPS情報の精度が低い場合や、GPSが取得できない環境での対応
  - 対応策：Wi-Fi位置情報の併用、手動入力の併用機能、複数回の位置情報取得による確認

- 課題2：勤怠自動判定のロジック
  - 詳細：位置情報から勤怠開始/終了をどのように判定するか
  - 対応策：事前登録した位置情報との距離計算、時間帯による判定ロジックの調整、機械学習による精度向上

- 課題3：複数提出先のフォーマット対応
  - 詳細：異なるフォーマットにどのように対応するか
  - 対応策：テンプレートベースの出力システム、各提出先APIとの連携機能

- 課題4：プライバシーとセキュリティ
  - 詳細：位置情報の収集に関するプライバシー懸念
  - 対応策：業務時間内のみの位置情報収集、明示的な同意取得、ローカルデータ保存優先

- 課題5：日本の労働法規制への対応
  - 詳細：36協定、変形労働時間制、フレックスタイム制など日本独自の労働法規制への対応
  - 対応策：法規制に基づいた勤務時間計算ロジックの実装、労働時間超過警告機能の追加
```

## 7. 変更履歴
| 日付 | 変更者 | 変更内容 |
|-----|-------|---------|
| 2025/06/01 | カーン | 初版作成 |
| 2025/06/02 | カーン | サービス展開国（日本のみ）の追加、日本の労働法規制対応に関する課題の追加 |
| 2025/06/02 | カーン | 非機能要件セクションの追加 |

---
※このドキュメントは開発の進行に合わせて随時更新されます。
