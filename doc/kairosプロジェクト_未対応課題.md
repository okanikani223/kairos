# kairosプロジェクト 未対応課題リスト

このドキュメントは、設計書間の矛盾や未解決の課題を整理したものです。

## 1. 用語・概念の不一致に関する課題

### 1.1. 場所を表す用語の不一致
- **課題**: 「勤怠情報提出先(Company)」と「勤務地」という用語の統一
- **対応案**: 
  - 用語集の作成 ✅ 完了（kairosプロジェクト_用語集.md）
  - 各設計書での用語統一 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（用語集作成完了、各設計書の用語統一完了）

### 1.2. 勤怠情報作成の主体の矛盾
- **課題**: 「自動勤怠情報作成」機能の独立性と実装方法
- **対応案**: 
  - 機能の明確な分離 ✅ 完了
  - 自動勤怠情報作成機能の詳細設計書作成 ✅ 完了（勤怠情報登録機能_機能設計.md）
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能として統合設計完了）

### 1.3. generateOptionsパラメータの動作明確化
- **課題**: `autoGenerate: true`で`generateOptions`が省略された場合の動作が不明確
- **対応案**: 
  - デフォルト値の明確化 ✅ 完了
  - 省略時の動作説明追加 ✅ 完了
  - エラーハンドリングの詳細化 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能_機能設計.mdでデフォルト値動作とエラーハンドリング明確化）

### 1.4. 既存設計書への用語集適用
- **課題**: 既存の設計書で用語集と異なる用語が混在している
- **対応案**: 
  - 各機能設計書の用語を用語集に合わせて修正 ✅ 完了
  - 統一された用語での再レビュー実施 ✅ 完了
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 完了（全機能設計書の用語統一完了）

## 2. 自動勤怠情報作成のロジック課題

### 2.1. 判定ロジックの不一致
- **課題**: 位置情報登録機能の「距離計算アルゴリズム」と勤怠情報取得機能の「勤務判定アルゴリズム」の関係が不明確
- **対応案**: 
  - アルゴリズム関係の明確化 ✅ 部分完了（勤怠情報登録機能で統合定義）
  - 共通ライブラリの定義
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 部分対応（アルゴリズム統合済み、共通ライブラリ化は未実施）

### 2.2. 休暇判定の記述と実装の不一致
- **課題**: 休暇判定ロジックがどこで実装されるか不明確
- **対応案**: 
  - 処理フローの詳細化 ✅ 部分完了（勤怠情報登録機能で定義）
  - コンポーネント分割と責務の明確化
- **優先度**: 中
- **担当者**: カーン
- **対応状況**: 部分対応（処理フロー定義済み、コンポーネント分割は未実施）

## 3. 新しい機能への対応課題

### 3.1. ユーザーの勤怠設定の参照不足
- **課題**: 新たに追加された「ユーザーの勤怠設定(UserAttendanceSetting)」モデルの参照方法が不明確
- **対応案**: 
  - 具体的な参照関係の明記 ✅ 完了（勤怠情報登録機能で使用方法定義）
  - 機能間の連携フローの図示 ✅ 完了（専用設計書で詳細化）
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: ✅ 完了（2025/06/08）
- **完了内容**: 
  - `ユーザー勤怠設定参照仕様_機能設計.md`を新規作成
  - 全機能設計書での参照方法と依存関係を明確化
  - 機能間連携フローをmermaid図で可視化

## 4. セキュリティ要件の整合性課題

### 4.1. アクセス権限の粒度
- **課題**: 「権限を付与された者」の定義や権限管理の方法が不明確
- **対応案**: 
  - アクセス権限マトリクスの作成
  - 権限付与の仕組みの明確化
- **優先度**: 中
- **担当者**: 未割当

## 5. 自動勤怠情報作成機能の独立設計

### 5.1. 新規機能設計書の作成
- **課題**: 「自動勤怠情報作成機能」の詳細設計がない
- **対応案**: 
  - 「自動勤怠情報作成機能_機能設計.md」の新規作成 ✅ 完了（勤怠情報登録機能として統合）
  - APIエンドポイントの設計 ✅ 完了
  - 処理フローの詳細化 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能に統合済み）

## 6. その他の課題

### 6.1. 共通コンポーネントの整理
- **課題**: 複数の機能で使用される共通ロジック（勤怠判定、休暇判定など）の管理方法が不明確
- **対応案**: 
  - 共通ライブラリ設計書の作成
  - 責務の分割と依存関係の明確化 ✅ 部分完了（勤怠情報登録機能で依存関係定義）
- **優先度**: 低
- **担当者**: カーン
- **対応状況**: 部分対応（依存関係明確化済み、共通ライブラリ設計書は未作成）

---

## 対応状況

| 課題ID | 課題名 | 優先度 | 対応状況 | 対応予定日 | 担当者 |
|------|------|------|--------|---------|------|
| 1.1 | 場所を表す用語の不一致 | 中 | 完了 | 2025/06/08 | カーン |
| 1.2 | 勤怠情報作成の主体の矛盾 | 高 | 完了 | 2025/06/08 | カーン |
| 1.3 | generateOptionsパラメータの動作明確化 | 中 | 完了 | 2025/06/08 | カーン |
| 1.4 | 既存設計書への用語集適用 | 中 | 完了 | 2025/06/08 | カーン |
| 2.1 | 判定ロジックの不一致 | 中 | 部分対応 | 未定 | カーン |
| 2.2 | 休暇判定の記述と実装の不一致 | 中 | 部分対応 | 未定 | カーン |
| 3.1 | ユーザーの勤怠設定の参照不足 | 高 | 完了 | 2025/06/08 | カーン |
| 4.1 | アクセス権限の粒度 | 中 | 未対応 | 未定 | - |
| 5.1 | 新規機能設計書の作成 | 高 | 完了 | 2025/06/08 | カーン |
| 6.1 | 共通コンポーネントの整理 | 低 | 部分対応 | 未定 | カーン |
| 7.1 | companyIdパラメータの削除 | 高 | 完了 | 2025/06/08 | カーン |
| 8.1 | 勤怠情報の更新・削除機能設計書の作成 | 高 | 完了 | 2025/06/08 | カーン |
| 9.1 | APIエンドポイントの命名規則の不一致 | 中 | 未対応 | 未定 | - |
| 9.2 | HTTPステータスコードの使用基準の不統一 | 中 | 未対応 | 未定 | - |
| 9.3 | レスポンス形式の構造不一致 | 中 | 未対応 | 未定 | - |
| 9.4 | エラーレスポンスのdetailsフィールド形式の不統一 | 低 | 未対応 | 未定 | - |
| 9.5 | 勤務判定アルゴリズムの重複定義と記載粒度の違い | 中 | 未対応 | 未定 | - |
| 9.6 | generateOptionsパラメータの記載詳細度の不一致 | 低 | 未対応 | 未定 | - |
| 9.7 | セキュリティ要件の記載レベルの格差 | 中 | 未対応 | 未定 | - |
| 9.8 | パフォーマンス要件の記載基準の不統一 | 低 | 未対応 | 未定 | - |
| 9.9 | テスト方針の記載詳細度の不統一 | 低 | 未対応 | 未定 | - |
| 9.10 | ドキュメント構造と章立ての不統一 | 中 | 未対応 | 未定 | - |
| 9.11 | 非機能要件の記載範囲と詳細度の格差 | 中 | 未対応 | 未定 | - |
| 9.12 | アルゴリズムと技術実装詳細の記載基準の不一致 | 低 | 未対応 | 未定 | - |
| 9.13 | 依存関係の記載レベルと分類の不統一 | 低 | 未対応 | 未定 | - |
| 9.14 | 変更履歴の有無と記載形式の不統一 | 低 | 未対応 | 未定 | - |
| 9.15 | 運用考慮事項と今後の拡張計画の記載格差 | 低 | 未対応 | 未定 | - |

## 新規追加された課題

### 7.1. companyIdパラメータの削除
- **課題**: 勤怠情報提出先（Company）機能が保留のため、自動生成時のcompanyIdパラメータを削除する必要がある
- **対応案**: 
  - API仕様からcompanyIdパラメータ削除 ✅ 完了
  - アルゴリズム関数をuserSettings参照に変更 ✅ 完了
  - 依存関係の更新 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（勤怠情報登録機能からcompanyId関連削除完了）

### 8.1. 勤怠情報の更新・削除機能設計書の作成
- **課題**: 勤怠情報の更新機能と削除機能の機能設計書が未作成
- **対応案**: 
  - 勤怠情報更新機能の機能設計書作成 ✅ 完了
  - 勤怠情報削除機能の機能設計書作成 ✅ 完了
  - 要件整理ドキュメントの状態更新 ✅ 完了
- **優先度**: 高
- **担当者**: カーン
- **対応状況**: 完了（更新・削除機能の設計書作成完了）

### 9.1. APIエンドポイントの命名規則の不一致
- **課題**: 各機能でAPIエンドポイントの命名パターンに一貫性がない
- **詳細**: 
  - 登録機能: `POST /api/v1/attendances`
  - 取得機能: `GET /api/v1/attendances`, `GET /api/v1/attendances/{year}`, `GET /api/v1/attendances/{year}/{month}`
  - 更新機能: `PUT /api/v1/attendances/{attendanceId}`, `PATCH /api/v1/attendances/{attendanceId}`, `PATCH /api/v1/attendances/{attendanceId}/details/{detailId}`
  - 削除機能: `DELETE /api/v1/attendances/{attendanceId}`, `DELETE /api/v1/attendances/{attendanceId}/details/{detailId}`, `PATCH /api/v1/attendances/{attendanceId}/disable`
- **対応案**: 
  - RESTful APIの標準パターンに統一
  - リソース識別子の命名規則を明確化
- **優先度**: 中
- **担当者**: 未割当

### 9.2. HTTPステータスコードの使用基準の不統一
- **課題**: 同様のエラー状況で異なるHTTPステータスコードが使用されている
- **詳細**: 
  - 取得機能: 勤怠情報が存在しない場合のステータスコードが404で明記
  - 更新・削除機能: 同様の状況でのステータスコードは明記されているが、統一性の検証が必要
  - 登録機能: 重複データエラーで409 Conflictを使用
- **対応案**: 
  - 各エラーシナリオに対するHTTPステータスコードの統一基準を作成
  - 全機能設計書でのステータスコード見直し
- **優先度**: 中
- **担当者**: 未割当

### 9.3. レスポンス形式の構造不一致
- **課題**: 機能間でレスポンスJSONの構造に違いがある
- **詳細**: 
  - 取得機能: `attendances`配列でデータを返却
  - 登録・更新機能: `attendance`オブジェクトでデータを返却
  - 削除機能: `data`オブジェクト内に詳細情報を格納
- **対応案**: 
  - 共通レスポンス形式の定義
  - APIレスポンススキーマの統一
- **優先度**: 中
- **担当者**: 未割当

### 9.4. エラーレスポンスのdetailsフィールド形式の不統一
- **課題**: エラーレスポンスの`details`フィールドで異なるデータ形式が使用されている
- **詳細**: 
  - 登録機能: `details`は配列形式で複数のフィールドエラーを格納
  - 更新機能: 同様に配列形式
  - 削除機能: `details`は文字列形式で単一の説明を格納
- **対応案**: 
  - エラーレスポンスの共通スキーマ定義
  - `details`フィールドの形式統一（配列形式に統一を推奨）
- **優先度**: 低
- **担当者**: 未割当

### 9.5. 勤務判定アルゴリズムの重複定義と記載粒度の違い
- **課題**: 複数の機能設計書で勤務判定アルゴリズムが異なる粒度で定義されている
- **詳細**: 
  - 登録機能: 距離計算アルゴリズム（Haversine公式）、勤務判定、休暇自動判定の詳細実装コードまで記載
  - 取得機能: 勤務判定アルゴリズムの概要のみ記載、実装詳細なし
  - 更新機能: 自動再生成時に登録機能のアルゴリズムを使用すると記載されているが詳細なし
- **対応案**: 
  - 共通アルゴリズムライブラリとして別文書に切り出し
  - 各機能設計書からは共通ライブラリを参照する形式に変更
  - 記載粒度を統一（概要 + 共通ライブラリ参照）
- **優先度**: 中
- **担当者**: 未割当

### 9.6. generateOptionsパラメータの記載詳細度の不一致
- **課題**: generateOptionsの取り扱いについて機能間で記載詳細度に差がある
- **詳細**: 
  - 登録機能: generateOptionsのデフォルト値、省略時の動作、各オプションの詳細な挙動説明
  - 更新機能: generateOptionsは自動再生成時に使用されると記載されているが、詳細説明なし
- **対応案**: 
  - generateOptionsの仕様を共通定義として別文書に作成
  - 各機能から共通定義を参照
- **優先度**: 低
- **担当者**: 未割当

### 9.7. セキュリティ要件の記載レベルの格差
- **課題**: 各機能でセキュリティ要件の記載詳細度が大きく異なる
- **詳細**: 
  - 登録機能: 基本的なアクセス権限のみ記載
  - 取得機能: 権限管理、バージョン管理まで言及
  - 更新機能: JWT認証、楽観的ロック、監査ログ等の詳細記載
  - 削除機能: 認証・認可、削除権限制御の詳細JSON例まで記載
- **対応案**: 
  - 共通セキュリティ要件文書の作成
  - 各機能固有のセキュリティ要件と共通要件の分離
  - 記載粒度の統一
- **優先度**: 中
- **担当者**: 未割当

### 9.8. パフォーマンス要件の記載基準の不統一
- **課題**: パフォーマンス要件の記載がある機能とない機能がある
- **詳細**: 
  - 登録機能: 自動生成処理の応答時間（5秒以内）、位置情報処理件数（最大1000件）
  - 取得機能: パフォーマンス要件の記載なし
  - 更新機能: 各更新タイプの詳細な応答時間目標、同時処理要件
  - 削除機能: パフォーマンス要件の記載なし
- **対応案**: 
  - 全機能で統一されたパフォーマンス要件基準を設定
  - SLA（Service Level Agreement）として共通定義を作成
- **優先度**: 低
- **担当者**: 未割当

### 9.9. テスト方針の記載詳細度の不統一
- **課題**: 各機能でテスト方針の記載詳細度が異なる
- **詳細**: 
  - 登録機能: 単体テスト、統合テスト、パフォーマンステストの詳細項目
  - 取得機能: テスト項目の概要のみ
  - 更新機能: 単体テスト、統合テスト、パフォーマンステストの詳細項目
  - 削除機能: テスト方針の記載なし
- **対応案**: 
  - 統一されたテスト方針テンプレートの作成
  - 各機能での必須テスト項目の標準化
- **優先度**: 低
- **担当者**: 未割当

### 9.10. ドキュメント構造と章立ての不統一
- **課題**: 機能設計文書の章立て構造が機能によって大きく異なる
- **詳細**: 
  - 登録機能: 10章構成（機能概要、API仕様、機能詳細、アルゴリズム詳細、非機能要件、エラーハンドリング、拡張性考慮事項、テスト方針、依存関係、変更履歴）
  - 取得機能: 7章構成（機能概要、API仕様、機能詳細、非機能要件、技術的実装詳細、拡張性考慮事項、テスト方針）
  - 更新機能: 9章構成（機能概要、API仕様、機能詳細、セキュリティ要件、パフォーマンス要件、エラーハンドリング、テスト方針、依存関係、変更履歴）
  - 削除機能: 12章構成（機能概要、API仕様、削除パターン別仕様、セキュリティ要件、エラーハンドリング、パフォーマンス要件、監査・ログ、処理フロー、テスト戦略、依存関係、運用考慮事項、今後の拡張計画）
  - 位置情報登録機能: 7章構成（機能概要、API仕様、機能詳細、非機能要件、技術的実装詳細、拡張性考慮事項、テスト方針）
- **対応案**: 
  - 機能設計書の統一テンプレートの作成
  - 必須章とオプション章の明確化
  - 記載粒度の標準化
- **優先度**: 中
- **担当者**: 未割当

### 9.11. 非機能要件の記載範囲と詳細度の格差
- **課題**: 非機能要件の章名、扱う範囲、記載詳細度が機能によって大きく異なる
- **詳細**: 
  - 登録機能: 「機能特有の非機能要件」（セキュリティ、データ整合性、パフォーマンス）
  - 取得機能: 「機能特有の非機能要件」（セキュリティ、エラー処理）
  - 更新機能: 「セキュリティ要件」「パフォーマンス要件」として分離
  - 削除機能: 「セキュリティ要件」「パフォーマンス要件」として分離
  - 位置情報登録機能: 「機能特有の非機能要件」（セキュリティ、プライバシー）
- **対応案**: 
  - 非機能要件の記載標準化（章名と扱う範囲の統一）
  - 機能特有の要件と共通要件の明確な区分
- **優先度**: 中
- **担当者**: 未割当

### 9.12. アルゴリズムと技術実装詳細の記載基準の不一致
- **課題**: 技術実装詳細やアルゴリズムの記載がある機能とない機能がある
- **詳細**: 
  - 登録機能: 「自動勤怠情報作成アルゴリズム詳細」章で詳細な実装コードまで記載
  - 取得機能: 「技術的実装詳細」章でアルゴリズム概要のみ記載
  - 更新機能: 機能詳細内で部分的な実装コード例を記載
  - 削除機能: 処理フローはMermaid図で記載、実装詳細なし
  - 位置情報登録機能: 「技術的実装詳細」章で距離計算アルゴリズムの実装コードを記載
- **対応案**: 
  - 実装詳細の記載レベル基準を設定（概要のみ、疑似コード、実装コード）
  - アルゴリズム詳細は共通ライブラリとして別文書化を推奨
- **優先度**: 低
- **担当者**: 未割当

### 9.13. 依存関係の記載レベルと分類の不統一
- **課題**: 依存関係の記載レベルと分類方法が機能によって異なる
- **詳細**: 
  - 登録機能: 「システム内依存」「外部依存」で分類、具体的なAPI名・ライブラリ名を記載
  - 取得機能: 依存関係の記載なし
  - 更新機能: 「システム内依存」「外部依存」で分類、詳細な依存内容を記載
  - 削除機能: 「内部システム依存」「外部システム依存」で分類、サービス単位で記載
  - 位置情報登録機能: 依存関係の記載なし
- **対応案**: 
  - 依存関係の分類基準を統一（内部/外部、機能/技術など）
  - 記載必須レベルの設定（全機能で基本的な依存関係は記載）
- **優先度**: 低
- **担当者**: 未割当

### 9.14. 変更履歴の有無と記載形式の不統一
- **課題**: 変更履歴があるドキュメントとないドキュメントがある
- **詳細**: 
  - 登録機能: 変更履歴あり（日付、変更者、変更内容のテーブル形式）
  - 取得機能: 変更履歴なし
  - 更新機能: 変更履歴あり（同様のテーブル形式）
  - 削除機能: 変更履歴なし
  - 位置情報登録機能: 変更履歴なし
- **対応案**: 
  - 全機能設計書で変更履歴を必須とする
  - 変更履歴の記載形式を統一
- **優先度**: 低
- **担当者**: 未割当

### 9.15. 運用考慮事項と今後の拡張計画の記載格差
- **課題**: 運用面や将来の拡張についての記載が一部の機能のみに限定されている
- **詳細**: 
  - 登録機能: 「拡張性考慮事項」章あり（将来拡張、制限事項）
  - 取得機能: 「拡張性考慮事項」章あり（概要のみ）
  - 更新機能: 拡張や運用考慮事項の記載なし
  - 削除機能: 「運用考慮事項」「今後の拡張計画」章あり（詳細な記載）
  - 位置情報登録機能: 「拡張性考慮事項」章あり（概要のみ）
- **対応案**: 
  - 全機能で拡張性考慮事項の記載を標準化
  - 運用面での考慮事項が必要な機能の基準を設定
- **優先度**: 低
- **担当者**: 未割当

---

※このドキュメントは開発の進行に合わせて随時更新されます。
